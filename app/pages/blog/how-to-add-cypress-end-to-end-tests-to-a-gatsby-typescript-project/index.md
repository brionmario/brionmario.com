---
slug: "/posts/how-to-add-cypress-end-to-end-tests-to-a-gatsby-typescript-project/"
date: "2021-10-05"
title: "How to add Cypress End-To-End tests to a Gatsby TypeScript project"
description: "End-To-End tests are vital for any front-end project if you‚Äôre concerned about the quality of the experience you provide to users with your application. In this post, I will go through the process of‚Ä¶"
authors:
  - id: "ca410be341b9"
    name: "Brion Mario"
    username: "brionmario"
    image: "https://miro.medium.com/fit/c/176/176/1*VyzrTxkrThOJKKnvx20UTg.png"
    bio: "Software Engineer working at WSO2."
    twitterScreenName: "brion_mario"
readingTime: "4 min read"
draft: false
tags:
  - "gatsby"
  - "cypress"
  - "e2e"
  - "typescript"
  - "testing"
bannerImage: "https://cdn-images-1.medium.com/max/2600/1*BpLXmjePx14gbaUELsp8yg@2x.png"
ogImage: "https://cdn-images-1.medium.com/max/2600/1*BpLXmjePx14gbaUELsp8yg@2x.png"
images:
  - "https://cdn-images-1.medium.com/max/2600/1*BpLXmjePx14gbaUELsp8yg@2x.png"
  - "https://cdn-images-1.medium.com/max/2600/1*To8voGdMTxFiJpAF9PBLiw.png"
  - "https://cdn-images-1.medium.com/max/2600/1*cK_AJ5bktWtCrR8CjtItuQ.png"
  - "https://cdn-images-1.medium.com/max/2600/1*yusFumRL1YN2-2OcPGQjOQ.png"
  - "https://cdn-images-1.medium.com/max/2600/1*yhiPhUnIYJ-8RFnOwTTupg.png"

---

# How to add Cypress End-To-End tests to a Gatsby TypeScript project

![](https://cdn-images-1.medium.com/max/800/1*BpLXmjePx14gbaUELsp8yg@2x.png)

End-To-End tests are vital for any front-end project if you‚Äôre concerned about the quality of the experience you provide to users with your application.

In this post, I will go through the process of adding E2E tests to a Gatsby TypeScript project with [Cypress](https://www.cypress.io/).

### Pre-requisites

You will need a Gatsby application to try this out. I will be using the [Gatsby Starter](https://github.com/brionmario/gatsby-starter) project that I built. Feel free to use the same or you can use this approach on any Gatsby TypeScript project.

> Read the [docs](https://www.gatsbyjs.com/docs/quick-start/) to learn how to create a Gatsby app or explore other TypeScript [starters](https://www.gatsbyjs.com/starters/?).

### Let‚Äôs get¬†started

#### Install Cypress

```js
npm i --save-dev cypress
```

#### Add helper npm¬†scripts

Add the following two scripts in the **script** section in `package.json`.

```js
"cy:headless": "cypress run",  
"cy:interactive": "cypress open",
```

**cy:headless**

Runs Cypress in [headless mode](https://docs.cypress.io/guides/guides/command-line#cypress-run-headless). Headless mode runs the tests without using any browser and outputs to the terminal.

**cy:interactive**

Runs Cypress in the interactive mode on a [test runner](https://docs.cypress.io/guides/core-concepts/test-runner#Overview).

#### Initial Run

Let‚Äôs run cypress in the interactive mode.

```js
npm run cy:interactive
```

Cypress will recognize that this is the first time, and will set up the necessary files and configurations, and will open up the test runner.

![Initial Autogenerated Files &¬†Folders](https://cdn-images-1.medium.com/max/800/1*To8voGdMTxFiJpAF9PBLiw.png)![Initial Test¬†Runner](https://cdn-images-1.medium.com/max/800/1*cK_AJ5bktWtCrR8CjtItuQ.png)

#### Add configurations

Let‚Äôs configure some basics in the `cypress.json` file.

```js
{
    "baseUrl": "http://localhost:8000",
    "integrationFolder": "cypress/e2e",
    "testFiles": "**/*.spec.*",
    "viewportHeight": 720,
    "viewportWidth": 1080
}
```

**baseUrl**

URL used as a prefix for <a href="https://docs.cypress.io/api/commands/visit" class="fenced-link">cy.visit()</a> Since my starter runs on [localhost port 8000](http://localhost:8000), I will be using that. You can add the URL for your own app here.

**integrationFolder**

Where tests are held. I prefer to rename this as **e2e** when I‚Äôm writing End-To-End tests using Cypress. Since integration could convey the wrong meaning in the context of e2e testing üòâ.

**testFiles**

Glob patterns of the test files to load. I like to name my test files as `*.spec.*`. You can use any pattern you want.

**viewportHeight**

Height in pixels for the application in the test runner. The default is **660** and  for my starter, it activates the tablet view. Hence, I prefer to go with **720**.

**viewportWidth**

Width in pixels for the application in the test runner. The default is **1000** and I prefer to go with **1080**.

#### Setup e2e¬†folder

Remove the **cypress/integration** folder inside the cypress directory and create a new folder called **e2e** inside  the **cypress** directory.

#### **Prepare for TypeScript**

**Configure tsconfig**

To write the tests in TypeScript, we need to have a `tsconfig.json`  file inside the **cypress** directory.

[Cypress documentation](https://docs.cypress.io/guides/tooling/typescript-support#Configure-tsconfig-json) recommends the following configuration.

```js
{
    "compilerOptions": {
        "target": "es5",
        "lib": [
            "es5",
            "dom"
        ],
        "types": [
            "cypress"
        ]
    },
    "include": [
        "**/*.ts"
    ]
} 
```

**Migrate existing JavaScript files to TypeScript**

1.  Rename the `index.js` file inside **cypress/support** directory to `index.ts`

2\. Rename the `index.js` file inside **cypress/plugins** directory to `index.ts`

The IDE will start to complain that it cannot find the name ‚Äòmodule‚Äô(TS2591). To fix this follow the steps below.

*   Install [@types/node](https://www.npmjs.com/package/@types/node).

```js
npm i --save-dev [@types/node](http://twitter.com/types/node "Twitter profile for @types/node")
```

*   Add ‚Äúnode‚Äù to **types** array in `tsconfig.json`**.**

```js
{
    "compilerOptions": {
        ...
        "types": [
            ...
            "node"
        ]
    },
    ...
} 
```

#### Let‚Äôs write our first¬†test

Create a new file called `smoke.spec.ts`

In this test, I will assert if the app can navigate to the **Home** page and **Pricing** page successfully.

```js
/// describe("The App works as expected.", () => {

    context("Can navigate to pages without issues.", () => {

        it("Can navigate to the home page.", () => {
            cy.visit("/");
        });

        it("Can navigate to the pricing page.", () => {
            cy.visit("/pricing");
        });
    });
}); 
```
![Test Runner after running the smoke.spec.ts](https://cdn-images-1.medium.com/max/800/1*yusFumRL1YN2-2OcPGQjOQ.png)

#### Let‚Äôs write our first custom¬†command

In my project, I use `data-testid` in elements as a unique id for testing. So I‚Äôm going to write a custom command to query elements using a data test id.

I will create a new file called `dom.ts` inside the **cypress/support** directory and will add a command there.

```js
/**
 * Custom command to select DOM element by data-testid attribute.
 *
 * @example
 *    cy.dataTestId("") -> [data-testid=]
 *
 * @param {string} value - Attribute value.
 * @param {string} options - Attribute value.
 * @returns {Cypress.CanReturnChainable}
 */
Cypress.Commands.add("dataTestId", (value: string): Cypress.CanReturnChainable => {

    return cy.get(`[data-testid=${ value }]`);
});
```

Now if I try to use the command in my smoke test file, I will get an error like this.

![Custom Command¬†Error](https://cdn-images-1.medium.com/max/800/1*yhiPhUnIYJ-8RFnOwTTupg.png)

This happens because TypeScript can not find any declaration file for the command. As of now, we have to write the typings manually to avoid these errors (Read official docs [here](https://docs.cypress.io/guides/tooling/typescript-support#Types-for-custom-commands)).

Inside the **cypress** directory**,** create a new folder called **types**. And inside that, create a new file called `index.d.ts`

Now define the typings for the custom command.

```js
/// 

declare namespace Cypress {
    interface Chainable {
        /**
         * Custom command to select DOM element by data-testid attribute.
         * @example cy.dataTestId("index-heading")
         */
        dataTestId(value: string): Chainable;
    }
}
```

With this fix, the error should be gone and we should be able to invoke the custom command inside the test files.

#### Additional Step

With the existing configurations, we have to fist start the application and then run the test suite.

This is a cumbersome process and it would be better if there is a ways to fire up the server and run the tests with a single command.

For this purpose, we can use the [start-server-and-test](https://www.npmjs.com/package/start-server-and-test) package.

1.  Install

```js
npm install --save-dev start-server-and-test
```

2\. Create an npm script.

```js
"test:e2e": "start-server-and-test start [http://localhost:8000](http://localhost:8000) cy:interactive"
```

Now if you execute `npm run test:e2e`¬†, the script will execute `npm run start` and will fire up the application and after it is up, it‚Äôll run Cypress in interactive mode.

### Conclusion

Hope you found this blog post useful. Feel free to try this out and if you have any suggestions regarding the blog you can log an issue in [this repo](https://github.com/brionmario/blog-resources/issues).

#### Links

*   [Source Code](https://github.com/brionmario/gatsby-starter/tree/init-cypress-e2e)

Signing off‚Ä¶ ‚úåÔ∏è‚ù§Ô∏è
